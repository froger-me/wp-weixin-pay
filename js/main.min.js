jQuery.fn.currencyFormat=function(){return this.each(function(){var e=this.value;if(""!==e&&"."!==e){var n=e.split(".");""===n[0]&&(n[0]=0,this.value=n.join(".")),n[0].startsWith(0)&&("0"!==n[0]||n[1])&&(n[0]=parseInt(n[0]),this.value=n.join(".")),n[1]&&2<n[1].length&&(n[1]=n[1].substring(0,2),this.value=n.join("."))}else this.value=""}),this},jQuery(document).ready(function(a){var o,n=500,i=1e3;function t(){var t={appId:""+o.appId,timeStamp:""+o.timeStamp,nonceStr:""+o.nonceStr,package:""+o.package,signType:"MD5",paySign:""+o.paySign},e={action:"wp_weixin_pay_init_check",transactionId:o.transactionId,nonceStr:a("#nonce_str").val()};a.ajax({url:WpWeixinPay.ajax_url,data:e,type:"POST",success:function(e){var n,i;e.success&&(n="getBrandWCPayRequest",i=t,WeixinJSBridge.invoke(n,i,function(e){"get_brand_wcpay_request:ok"===e.err_msg?r():"get_brand_wcpay_request:cancel"===e.err_msg?o.CancelPayUrl?window.location=o.CancelPayUrl:a(".submit").removeAttr("disabled"):"get_brand_wcpay_request:fail"===e.err_msg?(window.alert(e.err_desc),o.FailedPayUrl?window.location=o.FailedPayUrl:WeixinJSBridge.invoke("closeWindow",{},function(){})):window.setTimeout(function(){o.FailedPayUrl?window.location=o.FailedPayUrl:WeixinJSBridge.invoke("closeWindow",{},function(){})},1e4)}))},error:function(e,n){WpWeixinPay.debug&&window.alert(n)}})}function r(){var e={action:"wp_weixin_pay_check",transactionId:o.transactionId};a.ajax({url:WpWeixinPay.ajax_url,data:e,type:"POST",success:function(e){e.success?e.data.confirmed?WeixinJSBridge.invoke("closeWindow",{},function(){}):0<n--?setTimeout(r,i):o.TimeoutPayUrl?window.location=o.TimeoutPayUrl:(window.alert("timeout"),WeixinJSBridge.invoke("closeWindow",{},function(){})):WpWeixinPay.debug?window.alert(JSON.stringify(e)):WeixinJSBridge.invoke("closeWindow",{},function(){})},error:function(e,n){WpWeixinPay.debug&&window.alert(n)}})}wx.config({debug:!1,appId:WpWeixinPay.weixin.appid,timestamp:WpWeixinPay.weixin.timestamp,nonceStr:WpWeixinPay.weixin.nonceStr,signature:WpWeixinPay.weixin.signature,jsApiList:["hideAllNonBaseMenuItem"]}),wx.ready(function(){wx.hideAllNonBaseMenuItem(),wx.error(function(e){window.alert(e.errMsg)})}),a("#pay_amount").on("keyup",function(e){e.preventDefault(),a(this).currencyFormat()}),0<a(".notes-content input").val().length&&a(".add-notes").remove(),a(".add-notes").on("click",function(e){e.preventDefault(),a(".notes-content input").focus(),a(".mask").show(),a(".notes-container").show()}),a(".notes-actions a").on("click",function(e){e.preventDefault(),a(".mask").hide(),a(".notes-container").hide()}),a(".notes-actions a.cancel").on("click",function(e){e.preventDefault(),a(".notes-content input").val("")}),a(".submit").on("click",function(e){e.preventDefault();var n={amount:parseFloat(a("#pay_amount").val()),notes:a(".notes-content input").val(),nonceStr:a("#nonce_str").val(),action:"wp_weixin_pay"},i=a(this);i.attr("disabled","disabled"),n.amount?a.ajax({url:WpWeixinPay.ajax_url,data:n,type:"POST",success:function(e){if(e.success)!function(e){if("failure"===e.result)return;"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",t,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",t),document.attachEvent("onWeixinJSBridgeReady",t)):t()}(o=e.data);else{var i="";a.each(e.data,function(e,n){i+=n.message+"\n"}),window.alert(i)}},error:function(e,n){WpWeixinPay.debug&&window.console.log(n)}}):i.removeAttr("disabled")})});